name: divbase-tests
services:
  rabbitmq:
    ports: !override # port mapping is additive when merging compose files, unless overridden like this
      - 5673:5672 #host:container. for the testing env, it's enough to change the host port. The container port remains the same since it is for internal container communication.
  redis:
    ports: !override
      - 6380:6379
    volumes: !reset [] # reset to avoid conflicts with the redis settings in the main compose file
    tmpfs:
      - /data/
  worker-quick:
    volumes:
      - ../tests/fixtures:/app/tests/fixtures
    develop: !reset [] # no compose watch when running tests
  worker-long:
    volumes:
      - ../tests/fixtures:/app/tests/fixtures
    develop: !reset []
  flower:
    ports: !override
      - 5556:5555
    volumes: !reset []
    tmpfs:
      - /data/
    develop: !reset [] 
  minio:
    ports: !override
      - "9002:9000"
      - "9003:9001"
    volumes: !reset []
    tmpfs:
      - /data/
  fastapi:
    develop: !reset [] 
    ports: !override
      - 8001:8000
  postgres:
    ports: !override
      - "5433:5432"
    volumes: !reset []
    tmpfs:
      - /var/lib/postgresql/data/pgdata